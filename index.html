
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>杜甫羁旅诗动态地图</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Word 文件内容预览与切换</title>
  <!-- 通过 CDN 引入 docx-preview 库 -->
  <script src="https://unpkg.com/mammoth@1.4.17/mammoth.browser.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    @font-face {
      font-family: 'GuFeng';
      src: url('古风.ttf') format('truetype');
    }

    @font-face {
      font-family: 'GuFeng';
      src: url('古风.ttf') format('truetype');
    }

    @font-face {
      font-family: 'CustomEnglishFont';
      src: url('字体.ttf') format('truetype');
    }

    /* 英文统一字体 */
    [lang="en"], .en-font {
      font-family: 'CustomEnglishFont', sans-serif !important;
    }

    /* 中文统一字体 */
    html[lang="zh"], body[lang="zh"], [lang="zh"], body, html, .zh-font {
      font-family: 'GuFeng', 'KaiTi', '楷体', 'STKaiti', serif !important;
    }

    #map { height: 100vh; }
    #search-panel {
      font-family: 'GuFeng', serif;
      background-image: url('shuimo-bg.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      padding: 15px;
      width: 250px;
    }

    .popup-content { 
      font-family: "黑体", sans-serif; 
      font-weight: bold; 
    }

    .path-line {
      stroke: rgba(255, 200, 100, 0.8);
      stroke-width: 2.5;
      fill: none;
    }

    .moving-dot {
      fill: url(#glowGradient);
      stroke: none;
    }

    .place-label {
      font-family: 'GuFeng', 'KaiTi', '楷体', 'STKaiti', serif;
      font-size: 16px;
      color: #333;
      text-shadow: 1px 1px 2px #fff;
    }

    #sidebar {
      position: absolute;
      top: 0;
      left: 0;
      width: 220px;
      height: 100vh;
      background-image: url('sidebar.png');
      background-size: cover;
      background-position: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      padding: 15px;
      z-index: 1100;
      font-family: 'GuFeng', serif;
      transition: transform 0.3s ease;
    }

    #sidebar.collapsed {
      transform: translateX(-100%);
    }

    .nav-button {
        display: block;
        width: 100%;
        padding: 12px 15px;
        margin-bottom: 10px;
        font-family: 'GuFeng', serif;
        font-size: 16px;
        color: #333;
        text-shadow: 0 0 3px rgba(255,255,255,0.8);
        border: none;
        border-radius: 5px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        z-index: 1;
        transition: all 0.3s ease;
        opacity: 0;
        transition: opacity 1s ease;
    }

    .nav-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-size: cover;
        background-position: center;
        opacity: 0.4;
        z-index: -1;
        transition: opacity 0.3s ease;
    }

    .nav-button:nth-child(2)::before {
        background-image: url('daohangbutton1.png');
    }

    .nav-button:nth-child(3)::before {
        background-image: url('daohangbutton2.png');
    }

    .nav-button:nth-child(4)::before {
        background-image: url('daohangbutton3.png');
    }

    .nav-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .nav-button:nth-child(5)::before {
        background-image: url('daohangbutton4.png');
    }

    .nav-button:nth-child(6)::before {
        background-image: url('daohangbutton5.png');
    }

    .nav-button:nth-child(7)::before {
        background-image: url('daohangbutton6.png');
    }    

    .nav-button:hover::before {
        opacity: 0.6;
    }
   
    #chart-buttons {
        position: absolute;
        top: 80px;
        right: 30px;
        z-index: 2;
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 160px;
        white-space: normal;
    }

    .chart-switch-button {
        font-family: 'GuFeng', serif;
        background-color: rgba(255,255,255,0.8);
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        transition: background-color 0.3s ease;
        width: 100%;
        white-space: normal;
        text-align: center;
        min-width: 150px;
    }

    .chart-switch-button:hover {
      background-color: rgba(220,220,220,0.9);
    }

    .page-section {
      position: relative;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
    }

    #toggle-sidebar {
      position: absolute;
      top: 10px;
      left: 235px;
      width: 30px;
      height: 30px;
      background-color: #f5f5f5;
      border: none;
      border-radius: 0 15px 15px 0;
      cursor: pointer;
      z-index: 1200;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'GuFeng', serif;
      transition: all 0.3s ease;
      padding-left: 5px;
      overflow: hidden;
    }

    #toggle-sidebar.collapsed {
      left: 0;
      width: 15px;
      opacity: 0.7;
    }

    #toggle-sidebar.collapsed:hover {
      opacity: 1;
    }

    #content-container {
      margin-left: 220px;
      transition: margin-left 0.3s ease;
    }

    #content-container.expanded {
      margin-left: 0;
    }
    
    /*数据统计页面*/
    #page-stats {
      position: relative;
      background-image: url('p2.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }
    
    #page-stats::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255,255,255,0.7);
      z-index: 0;
    }
    
    #page-stats h3 {
      position: relative;
      z-index: 1;
      text-align: center;
      font-size: 28px;
      margin-top: 30px;
      color: #333;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }
    
    #page-stats p {
      position: relative;
      z-index: 1;
      width: 80%;
      margin: 20px auto;
      padding: 20px;
      background-color: rgba(255,255,255,0.85);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    #chart-container {
      position: relative;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 800px;
      margin: 20px auto;
      height: 500px;
      overflow: visible;
      background-image: url('柱形图bg.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /*柱形图设计*/
    .bar {
      transition: all 0.3s ease;
      fill: url(#barPattern);
      transform-origin: bottom center;
    }

    .bar:hover {
      transform: scaleY(1.1);
    }

    .axis-text {
      font-family: 'GuFeng', serif;
      font-size: 14px;
    }

    .chart-title {
      font-family: 'GuFeng', serif;
      font-size: 16px;
      text-anchor: middle;
    }

    .value-label {
      font-family: 'GuFeng', serif;
      font-size: 12px;
      fill: #333;
      text-anchor: middle;
      font-weight: bold;
    }

    .x-axis text {
      text-anchor: end;
      transform: rotate(-45deg);
      font-size: 12px;
    }

    .x-axis .tick text {
      transform: rotate(-45deg) translate(-5px, -10px);
    }

    .tooltip {
      position: absolute;
      text-align: center;
      background: white;
      border: 1px solid #999;
      border-radius: 5px;
      padding: 5px;
      font-size: 14px;
      pointer-events: none;
      line-height: 1.4em;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      font-family: 'GuFeng', serif;
    }

    /*折线图设计*/
    .timeline-line {
        stroke: #000;
        stroke-width: 3;
        fill: none;
    }

    .timeline-area {
        fill: url(#areaGradient);
        opacity: 0.6;
    }

    .timeline-dot {
        fill: #000;
        stroke: white;
        stroke-width: 2;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .timeline-dot:hover {
        fill: #333;
        transform: scale(1.2);
    }

    .timeline-label {
        font-family: 'GuFeng', serif;
        font-size: 12px;
        fill: #333;
        text-anchor: middle;
        font-weight: bold;
    }

    #chart-container object, #chart-container iframe {
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    /*高频词表设计*/
    .freq-table {
        width: 90%;
        margin: 20px auto;
        border-collapse: collapse;
        font-family: 'GuFeng', serif;
        background-color: rgba(255, 255, 255, 0.9);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .freq-table th, .freq-table td {
        padding: 12px 15px;
        text-align: center;
        border-bottom: 1px solid #ddd;
    }

    .freq-table th {
        background-color: #f8f8f8;
        font-weight: bold;
        position: sticky;
        top: 0;
    }

    .freq-table tr:hover {
        background-color: #f5f5f5;
    }

    .freq-table .highlight {
        background-color: #fffacd;
        font-weight: bold;
    }

    .sortable {
        cursor: pointer;
        user-select: none;
    }

    .sortable:hover {
        background-color: #f0f0f0;
    }

    .sort-icon {
        margin-left: 5px;
        font-size: 12px;
    }

    #chart-buttons {
        position: absolute;
        top: 80px;
        right: 30px;
        z-index: 2;
        display: flex;
        flex-direction: column;
        gap: 10px;
        width: 120px;
    }

    #table-container {
        max-height: 400px;
        overflow-y: auto;
        margin: 20px auto;
        width: 90%;
        background-color: rgba(255, 255, 255, 0.85);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .pagination-controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 15px;
    }

    .page-button {
        padding: 8px 15px;
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        font-family: 'GuFeng', serif;
    }

    .page-button:hover {
        background-color: #e0e0e0;
    }

    .page-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .page-info {
        font-family: 'GuFeng', serif;
        line-height: 34px;
    }

    /*译文界面设计*/
    #page-translation {
        background-image: url('p2.png');
        background-size: cover;
        background-attachment: fixed;
        background-position: center;
        overflow-y: auto;
    }

    .translation-container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.85);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .translation-title {
        text-align: center;
        font-family: 'GuFeng', serif;
        font-size: 28px;
        margin: 20px 0;
        color: #333;
        text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }

    .poem-display {
        display: flex;
        gap: 20px;
        min-height: 300px;
    }

    .poem-original, .poem-translation {
        flex: 1;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .poem-header {
        font-family: 'GuFeng', serif;
        font-size: 20px;
        margin-bottom: 15px;
        text-align: center;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
    }

    .poem-content {
        font-family: 'KaiTi', '楷体', 'STKaiti', serif;
        font-size: 16px;
        line-height: 1.8;
        white-space: pre-line;
    }

    /*诗歌卡片设计*/
    .poems-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }
    
    .poem-card {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.15);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        height: 280px;
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .poem-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    .poem-card-title-container {
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
        margin-bottom: 10px;
    }

    .poem-card-title {
        font-family: 'GuFeng', serif;
        font-size: 18px;
        font-weight: bold;
        text-align: center;
        margin-bottom: 5px;
    }

    .poem-card-translation-title {
        font-family: 'GuFeng', serif;
        font-size: 16px;
        color: #555;
        text-align: center;
        font-style: italic;
    }

    .poem-card-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 15px;
        overflow: hidden;
    }

    .poem-card-original, .poem-card-translation {
        flex: 1;
        overflow: hidden;
    }

    .poem-card-section-title {
        font-family: 'GuFeng', serif;
        font-size: 14px;
        color: #888;
        margin-bottom: 5px;
    }

    .poem-card-text {
        font-family: 'KaiTi', '楷体', 'STKaiti', serif;
        font-size: 14px;
        line-height: 1.6;
        color: #333;
        display: -webkit-box;
        -webkit-line-clamp: 5;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .view-full-button {
        margin-top: 10px;
        padding: 5px 10px;
        background-color: rgba(245, 245, 245, 0.8);
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        font-family: 'GuFeng', serif;
        font-size: 12px;
        text-align: center;
        transition: background-color 0.3s;
    }

    .view-full-button:hover {
        background-color: rgba(220, 220, 220, 0.9);
    }

    /*开发者声明界面设计*/
    #page-developerStatement {
        position: relative;
        background-image: url('p2.png');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
        display: none;
        height: 100vh;
        overflow: auto;
        z-index: 1;
    }

    .lang-switch-button2 {
        font-family: 'GuFeng', serif;
        background-color: rgba(255, 255, 255, 0.8);
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: background-color 0.3s ease;
        display: block;
        margin: 20px auto;
        z-index: 2;
        width: 100px;
        height: 40px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #statement-content {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.85);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        height: 80vh;
        overflow-y: auto;
        z-index: 2;
    }

    .lang-switch-button {
        font-family: 'GuFeng', serif;
        background-color: rgba(255, 255, 255, 0.8);
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: background-color 0.3s ease;
        display: block;
        margin: 20px auto;
        z-index: 2;
        width: 60px;
        height: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .lang-switch-button:hover {
        background-color: rgba(220, 220, 220, 0.9);
    }

    /*初始加载画面设计*/
    #splash-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-image: url('fengmian.png');
        background-size: cover;
        background-position: center;
        z-index: 9999;
        opacity: 1;
        transition: opacity 2s ease-out;
    }
    #splash-screen.fade-out {
        opacity: 0;
        pointer-events: none;
    }

    .developer-statement-title {
        font-size: 24px; /* 加大标题字体大小，可按需调整 */
        font-weight: bold; /* 标题字体加粗 */
        text-align: center; /* 标题居中显示 */
        margin-bottom: 20px; /* 标题与正文之间的间距 */
    }
    #statement-content {
        font-family: '仿宋', 'FangSong', serif;      
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.85);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        height: 80vh;
        overflow-y: auto;
        z-index: 2;
        font-size: 20px; /* 减小正文部分字体大小，可按需调整 */
    }


    .emotion-bar {
        transition: all 0.3s ease;
        transform-origin: bottom center;
        /* 不设置 fill，JS 动态设定颜色 */
    }

    /*开放论坛界面设计*/
    #page-openForum {
      position: relative;
      background-image: url('p2.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      display: none;
      height: 100vh;
      overflow: auto;
      z-index: 1;
    }

    .forum-container {
      width: 90%;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .bullet-chat-container {
      height: 300px;
      position: relative;
      overflow: hidden;
      border: 1px solid #ddd;
      margin: 20px 0;
    }

    .comment-input-area {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    #nickname-input {
      width: 200px;
      height: 20px;
      padding: 8px 12px;
      font-family: 'GuFeng', serif;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: rgba(255,255,255,0.9);
    }

    #comment-input {
      width: 90%;
      height: 120px;
      padding: 12px;
      font-family: 'KaiTi', '楷体', 'STKaiti', serif;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
      background-color: rgba(255,255,255,0.9);
    }

    #submit-comment {
      width: 120px;
      height: 35px;
      font-family: 'GuFeng', serif;
      font-size: 16px;
      background-color: rgba(200,200,200,0.8);
      border: 1px solid #999;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
      transition: all 0.3s; /* 添加过渡效果使状态变化更平滑 */
    }

    #submit-comment:hover {
      background-color: rgba(180,180,180,0.9);
    }

    .comment-list {
      max-height: 400px;
      overflow-y: auto;
    }

    #submit-comment:disabled {
      background-color: rgba(200,200,200,0.5) !important;
      cursor: not-allowed !important;
    }

    #page-fieldwork {
      position: relative;
      background-image: url('p2.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      display: none;
      height: 100vh;
      overflow: auto;
      z-index: 1;
    }
    
    .fieldwork-container {
      width: 90%;
      max-width: 1000px;
      margin: 40px auto;
      padding: 30px;
      background-color: rgba(255, 255, 255, 0.85);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .fieldwork-title {
      text-align: center;
      font-family: 'GuFeng', serif;
      font-size: 32px;
      margin-bottom: 30px;
      color: #333;
      text-shadow: 1px 1px 3px rgba(255,255,255,0.8);
    }
    
    .location-buttons {
      display: flex;
      flex-direction: column;
      gap: 40px;
    }
    
    .location-button {
      padding: 80px 25px;
      font-family: 'GuFeng', serif;
      font-size: 50px;
      color: #333;
      text-align: center;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      background-color: rgba(255, 255, 255, 0.8);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      background-size: cover; /* 关键代码 */
      background-position: center; /* 图片居中显示 */
    }
    
    .location-button:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    .location-button:nth-child(1) {
      background-image: url('locationbutton1.png'); /* 成都 */
      color: white; /* 文字白色 */
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8); /* 可选：增加阴影提升可读性 */
    }

    .location-button:nth-child(2) {
      background-image: url('locationbutton2.heic'); /* 奉节 */
      color: white; /* 文字白色 */
      background-position: center 70%; /* 原center改为center 70%，图片下移 */
    }

    .location-button:nth-child(3) {
      background-image: url('locationbutton3.heic'); /* 长沙 */
      color: white; /* 文字白色 */
    }

    .location-button:nth-child(4) {
      background-image: url('locationbutton4.heic'); /* 岳阳 */
      color: white; /* 文字白色 */
      background-position: center 80%;
    }

    .location-button:nth-child(5) {
      background-image: url('locationbutton5.jpg'); /* 衡阳 */
      color: white; /* 文字白色 */
      background-position: center 50%;
    }

  </style>
</head>

<body>
    <div id="splash-screen"></div>
    <button id="toggle-sidebar" title="隐藏/展开导航栏">≡</button>
    <div id="sidebar">
      <div style="display: flex; justify-content: space-between;align-items: center;">
        <h2 data-i18n="navTitle" style="margin: 0;">导航</h2>
        <button id="global-lang-toggle" class="lang-switch-button" style="margin: 0;">English</button>
      </div>
        <button class="nav-button" onclick="switchPage('map')" data-i18n="nav1">杜甫羁旅诗地图</button>
        <button class="nav-button" onclick="switchPage('stats')" data-i18n="nav2">数据统计</button>
        <button class="nav-button" onclick="switchPage('translation')"  data-i18n="nav3">杜甫羁旅诗英译</button>
        <button class="nav-button" onclick="switchPage('fieldwork')" data-i18n="nav6">实地考察图册</button>
        <button class="nav-button" onclick="switchPage('developerStatement')" data-i18n="nav4">开发者声明</button>
        <button class="nav-button" onclick="switchPage('openForum')" data-i18n="nav5">开放论坛</button>
    </div>
    <div id="content-container">
        <div id="page-map" class="page-section">
            <div id="map"></div>
            <div id="search-panel"
                style="position: absolute; top: 20px; right: 20px; width: 250px; padding: 15px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.3); z-index: 1000;">
                <h3 style="margin-top: 0; font-family: 'GuFeng', serif;" data-i18n="searchTitle">检索诗歌</h3>
                <input type="text" id="search-input" placeholder="输入诗歌标题..."
                    style="width: 100%; padding: 8px; margin-bottom: 10px; box-sizing: border-box; font-family: 'GuFeng', serif;">
                <div id="search-result" style="font-family: 'GuFeng', serif; font-size: 14px;"></div>
            </div>
        </div>
        <div id="page-stats" class="page-section" style="display: none;">
            <h3 style="font-family: 'GuFeng', serif; text-align: center; margin-top: 20px;" data-i18n="statistics">
                杜甫羁旅诗相关统计数据
            </h3>
            <div id="chart-buttons" style="position: absolute; top: 20px; right: 30px; z-index: 2;">
                <button class="chart-switch-button" onclick="switchChart('region')"  data-i18n="chart1">地区分布柱形图</button>
                <button class="chart-switch-button" onclick="switchChart('timeline')" data-i18n="chart2">时间分布折线图</button>
                <button class="chart-switch-button" onclick="switchChart('concept')" data-i18n="chart3">羁旅概念网络</button>
                <button class="chart-switch-button" onclick="switchChart('wordfreq')" data-i18n="chart4">高频词统计</button>
                <button class="chart-switch-button" onclick="switchChart('sentiment')" data-i18n="chart5">译文情感分析</button>
            </div>
            <div id="chart-container"></div>
        </div>
        <div id="page-translation" class="page-section" style="display: none;">
            <div class="translation-container">
                <h2 class="translation-title" data-i18n="ori_trans">杜甫羁旅诗原文及译文</h2>
                <!-- 诗歌展示区域 -->
                <div id="poems-grid" class="poems-grid">
                    <!-- 这里将通过JavaScript动态生成诗歌卡片 -->
                </div>
                <!-- 单个诗歌展示区域 (初始隐藏) -->
                <div id="single-poem-display" class="single-poem-display" style="display: none;">
                    <button class="back-button" onclick="showAllPoems()" data-i18n="back">返回列表</button>
                    <div class="poem-display">
                        <div class="poem-original">
                            <h3 class="poem-header" data-i18n="origins">诗歌原文</h3>
                            <div id="original-content" class="poem-content"></div>
                        </div>
                        <div class="poem-translation">
                            <h3 class="poem-header" data-i18n="translations">诗歌译文</h3>
                            <div id="translation-content" class="poem-content"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="page-developerStatement" class="page-section"> 
            <div id="developer-statement-content">
                <div id="statement-inner">
                    <h2 class="developer-statement-title" data-i18n="claim">开发者声明</h2>
                    <!-- 用于显示声明内容的区域 -->
                    <div id="statement-content" class="statement-content">
                    </div>
                    <button id="lang-switch-button2" class="lang-switch-button2">English</button>
                </div>
            </div>
        </div>
        <!-- 开放论坛 -->
        <div id="page-openForum" class="page-section" style="display: none;">
          <div class="forum-container">
            <h2 class="forum-title" data-i18n="forumTitle">开放论坛</h2>
              <div class="comment-input-area">
              <div class="nickname-submit-container">
                <input type="text" id="nickname-input" data-i18n-placeholder="nicknamePlaceholder" placeholder="昵称">
                <button id="submit-comment"  data-i18n="submitButton" disabled>发布</button>
              </div>
              <textarea id="comment-input" data-i18n-placeholder="commentPlaceholder" placeholder="请输入评论..."></textarea>
            <div class="bullet-chat-container"></div>
            <div class="comment-list"></div>
            <div class="comment-list"></div>
            </div>
          </div>
        </div>
        <div id="page-fieldwork" class="page-section" style="display: none;">
          <div class="fieldwork-container">
            <h2 class="fieldwork-title" data-i18n="fieldworkTitle">考察日志</h2>
            <div class="location-buttons">
              <button class="location-button" onclick="showLocationGallery('成都')" data-i18n="location1">成都</button>
              <button class="location-button" onclick="showLocationGallery('奉节')" data-i18n="location2">奉节</button>
              <button class="location-button" onclick="showLocationGallery('长沙')" data-i18n="location3">长沙</button>
              <button class="location-button" onclick="showLocationGallery('岳阳')" data-i18n="location4">岳阳</button>
              <button class="location-button" onclick="showLocationGallery('衡阳')" data-i18n="location5">衡阳</button>
            </div>
          </div>
        </div>
          

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<script>

  window.addEventListener('load', function () {
    setTimeout(() => {
      const splashScreen = document.getElementById('splash-screen');
      splashScreen.classList.add('fade-out');
      setTimeout(() => {
        splashScreen.parentNode.removeChild(splashScreen);
      }, 2000);
    }, 2000);
  });

  const translations  = {
    zh: {
      navTitle: "导航",
      nav1: "杜甫羁旅诗地图",
      nav2: "数据统计",
      nav3: "杜甫羁旅诗英译",
      nav4: "开发者声明",
      nav5: "开放论坛",
      nav6: "实地考察图册",
      searchTitle: "检索诗歌",
      searchPlaceholder: "输入诗歌标题...",
      statistics: "杜甫羁旅诗相关统计数据",
      chart1: "地区分布柱形图",
      chart2: "时间分布折线图",
      chart3: "羁旅概念网络",
      chart4: "高频词统计",
      chart5: "译文情感分析",
      senti_title: "杜甫羁旅诗译文情感分析",
      poem_id: "诗歌顺序",
      sentimental_index: "情感指数",
      senti_scale: "情感值",
      senti_edge1: "正向",
      senti_edge2: "负向",
      ori_trans: "杜甫羁旅诗原文及译文",
      back: "返回列表",
      origins :"诗歌原文",
      translations :"诗歌译文",
      claim: "开发者声明",
      claimbutton: "English",
      barChartXAxis: "地区",
      barChartYAxis: "诗歌数量",
      barChartTitle: "杜甫羁旅诗地区分布统计图",
      lineChartXAxis: "年份",
      lineChartYAxis: "诗歌数量",
      lineChartTitle: "杜甫羁旅诗时间分布折线图",
      wordFreqTableTitle: "杜甫羁旅诗高频词统计",
      wordFreqRank: "排名",
      wordFreqCharacter: "汉字",
      wordFreqFreq: "出现频率",
      poemOriginalTitle: "原文",
      poemTranslationTitle: "译文",
      switchToEnglish: "English",
      forumTitle: "开放论坛",
      nicknamePlaceholder: "昵称",
      commentPlaceholder: "请输入评论...",
      submitButton: "发布",
      fieldworkTitle: "考察日志",
      location1: "成都",
      location2: "奉节",
      location3: "长沙",
      location4: "岳阳",
      location5: "衡阳"
    },
    en: {
      navTitle: "Navigation",
      nav1: "Sojourner Poems Map", 
      nav2: "Statistics",
      nav3: "Translations of Sojourner Poems",
      nav4: "Developer Statement",
      nav5: "Open Forum",
      nav6: "Fieldwork Album",
      searchTitle: "Poems Search",
      searchPlaceholder: "Enter poem title...",
      statistics: "Statistics of Du Fu Sojourner Poems",
      chart1: "Regional Distribution Bar Chart",
      chart2: "Chronological Distribution Line Chart",
      chart3: "Semantic Network of Sojourn",
      chart4: "High-frequency Characters",
      chart5: "Sentiment Analysis of Translations",
      senti_title: "Sentiment Analysis of Du Fu Sojourner Poems Translations",
      poem_id: "Poem id",
      sentimental_index: "Sentimental Index",
      senti_scale: "Scale",
      senti_edge1: "Positive",
      senti_edge2: "Negative",
      ori_trans: "Original Poems and Translations",
      back: "back",
      origins :"Original Poems",
      translations :"Translation",
      claim: "Developer Statement",
      claimbutton: "切换至中文",
      barChartXAxis: "Region",
      barChartYAxis: "Number of Poems",
      barChartTitle: "Regional Distribution Chart of Du Fu's Sojourner Poems",
      lineChartXAxis: "Year",
      lineChartYAxis: "Number of Poems",
      lineChartTitle: "Chronological Distribution Line Chart of Du Fu's Sojourner Poems",
      wordFreqTableTitle: "High-frequency Characters in Du Fu's Sojourner Poems",
      wordFreqRank: "Rank",
      wordFreqCharacter: "Characters",
      wordFreqFreq: "Freq.",
      poemOriginalTitle: "Original Poem",
      poemTranslationTitle: "Translation",
      switchToChinese: "中文",
      forumTitle: "Open Forum",
      nicknamePlaceholder: "Nickname",
      commentPlaceholder: "Leave your comment...",
      submitButton: "Submit",
      fieldworkTitle: "Fieldwork Log",
      location1: "Chengdu",
      location2: "Fengjie",
      location3: "Changsha",
      location4: "Yueyang",
      location5: "Hengyang"
    }
  };

  // 语言切换函数
  function applyTranslations(lang) {
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (translations[currentLang] && translations[currentLang][key]) {
        el.textContent = translations[currentLang][key];
      }
    });

    const searchInput = document.getElementById('search-input');
    if (searchInput && translations[currentLang].searchPlaceholder) {
      searchInput.placeholder = translations[currentLang].searchPlaceholder;
    }

    const input = document.getElementById('search-input');
    if (input) {
      input.placeholder = translations[currentLang].searchPlaceholder;
    }

    const btn = document.getElementById('global-lang-toggle');
    if (btn) {
      btn.textContent = lang === 'zh'
        ? translations.zh.switchToEnglish
        : translations.en.switchToChinese;
    }

    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
      const key = el.getAttribute('data-i18n-placeholder');
      if (translations[lang] && translations[lang][key]) {
        el.placeholder = translations[lang][key];
      }
    });

    // 更新图表
    if (lang === 'en') {
        switchChart('region');// 重新加载地区分布柱形图，此时会使用英文文本创建图表
        switchChart('timeline');// 重新加载时间分布折线图，此时会使用英文文本创建图表
        switchChart('sentiment');// 重新加载情感分析图，此时会使用英文文本创建图表
    } else {
        switchChart('region');// 重新加载地区分布柱形图，此时会使用中文文本创建图表
        switchChart('timeline');// 重新加载时间分布折线图，此时会使用中文文本创建图表
        switchChart('sentiment');//重新加载情感分析图，此时会使用中文文本创建图表
    }
    if (lang === 'en' || lang === 'zh') {
        loadPoemsData();// 重新加载诗歌数据并渲染，此时会使用对应语言文本
    }
  }

  // 点击切换事件
  let currentLang = 'zh';
  document.addEventListener('DOMContentLoaded', () => {
    const langBtn = document.getElementById('global-lang-toggle');
    if (langBtn) {
      langBtn.addEventListener('click', () => {
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        applyTranslations(currentLang);
      });
    }
  });

  var map = L.map('map', {
    maxBounds: [
      [15, 70],
      [55, 140]
    ],
    maxBoundsViscosity: 1.0,
    minZoom: 4,
    maxZoom: 10
  }).setView([30.5, 105], 4.5);

  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; CartoDB'
  }).addTo(map);

  var svgLayer = L.svg().addTo(map);
  var svg = d3.select("#map").select("svg");
  var g = svg.append("g").attr("class", "leaflet-zoom-hide");

  var defs = svg.append("defs");
  var gradient = defs.append("radialGradient")
    .attr("id", "glowGradient");
  gradient.append("stop")
    .attr("offset", "0%")
    .attr("stop-color", "yellow")
    .attr("stop-opacity", 1);
  gradient.append("stop")
    .attr("offset", "100%")
    .attr("stop-color", "gold")
    .attr("stop-opacity", 0);

  var path, dot, totalLength;
  var locationArray = [];
  var duration = 60000;

  document.getElementById('toggle-sidebar').addEventListener('click', function() {
    var sidebar = document.getElementById('sidebar');
    var content = document.getElementById('content-container');
    var toggleBtn = document.getElementById('toggle-sidebar');
    
    sidebar.classList.toggle('collapsed');
    content.classList.toggle('expanded');
    toggleBtn.classList.toggle('collapsed');
  });

  Papa.parse('地域v5.csv', {
    download: true,
    header: true,
    complete: function(results) {
      let data = results.data.filter(d => d.latitude && d.longitude);

      let locations = {};
      data.forEach(d => {
        let key = d.latitude + ',' + d.longitude;
        if (!locations[key]) {
          locations[key] = {
            lat: +d.latitude,
            lng: +d.longitude,
            poems: [],
            name: d.location || "",
            minTime: d.created_time
          };
        }
        locations[key].poems.push(d.title);
      });

      locationArray = Object.values(locations).sort((a, b) => {
        return new Date(a.minTime) - new Date(b.minTime);
      });

      var guofengIcon = L.icon({
        iconUrl: 'guofeng-marker.png',
        iconSize: [40, 40],
        iconAnchor: [20, 40],
        popupAnchor: [0, -40]
      });

      locationArray.forEach(loc => {
        var marker = L.marker([loc.lat, loc.lng], { icon: guofengIcon }).addTo(map);
        marker.bindPopup("<div class='popup-content'>" + loc.poems.join("<br>") + "</div>");

        if (loc.name) {
          var label = L.marker([loc.lat, loc.lng], {
            icon: L.divIcon({
              className: 'place-label',
              html: loc.name,
              iconSize: [100, 20],
              iconAnchor: [-10, 10]
            })
          }).addTo(map);
        }
      });

      initPath();
      animateDot();
    }
  });

  function initPath() {
    if (path) path.remove();
    if (dot) dot.remove();

    var pathGenerator = d3.line()
      .curve(d3.curveCatmullRom.alpha(0.5))
      .x(d => map.latLngToLayerPoint([d.lat, d.lng]).x)
      .y(d => map.latLngToLayerPoint([d.lat, d.lng]).y);

    path = g.append("path")
      .datum(locationArray)
      .attr("class", "path-line")
      .attr("d", pathGenerator);

    totalLength = path.node().getTotalLength();

    dot = g.append("image")
      .attr("href", "船.png")
      .attr("height", "60")
      .attr("width", "60")
      .attr("class", "moving-dot");
  }

  function animateDot() {
    if (!path || !dot) return;

    dot.transition()
      .duration(duration)
      .ease(d3.easeLinear)
      .attrTween("transform", function() {
        return function(t) {
          var p = path.node().getPointAtLength(t * totalLength);
          return "translate(" + (p.x - 30) + "," + (p.y - 30) + ")";
        };
      })
      .on("end", function() {
        animateDot(); // 循环动画
      });
  }

  map.on("zoomend moveend", function() {
    if (dot) dot.interrupt();
    initPath();
    animateDot();
  });

  document.getElementById('search-input').addEventListener('input', function(e) {
    var keyword = e.target.value.trim();
    var resultDiv = document.getElementById('search-result');
    
    if (!keyword) {
      resultDiv.innerHTML = '';
      return;
    }

    var matches = [];
    locationArray.forEach(loc => {
      loc.poems.forEach(title => {
        if (title.includes(keyword)) {
          let year = '';
          if (loc.minTime) {
            year = new Date(loc.minTime).getFullYear();
          }
          matches.push({
            title: title,
            location: loc.name || '未知地点',
            year: year || '未知年份'
          });
        }
      });
    });

    if (matches.length === 0) {
      resultDiv.innerHTML = '未找到相关诗歌';
    } else {
      resultDiv.innerHTML = matches.map(m => `
        <div style="margin-bottom: 8px;">
          <strong>${m.title}</strong><br>
          地点：${m.location}<br>
          年份：${m.year}
        </div>
      `).join('');
    }
  });

  function switchPage(page) {
    document.getElementById('page-map').style.display = (page === 'map') ? 'block' : 'none';
    document.getElementById('page-stats').style.display = (page === 'stats') ? 'block' : 'none';
    document.getElementById('page-developerStatement').style.display = (page === 'developerStatement')? 'block' : 'none';
    document.getElementById('page-translation').style.display = (page === 'translation') ? 'block' : 'none';
    document.getElementById('page-developerStatement').style.display = (page === 'developerStatement') ? 'block' : 'none';
    document.getElementById('page-openForum').style.display = (page === 'openForum') ? 'block' : 'none';
    document.getElementById('page-fieldwork').style.display = (page === 'fieldwork') ? 'block' : 'none';
    
    document.getElementById('search-panel').style.display = (page === 'map') ? 'block' : 'none';
    
    if (page === 'stats') {
      setTimeout(loadChartData, 100);
    } else if (page === 'translation') {
      loadPoemsData();
    } else if (page === 'developerStatement') {

    }
  }

  function switchChart(type) {
    d3.select("#chart-container").selectAll("*").remove();

    if (type === 'region') {
      loadChartData();
    } else if (type === 'timeline') {
      loadTimelineChart();
    } else if (type === 'concept') {
      loadConceptNetwork();
    } else if (type === 'wordfreq') {
      loadWordFrequency();
    } else if (type === 'sentiment') {
      renderSentimentChart();
    }
  }

  function loadTimelineChart() {
    Papa.parse('地域v5.csv', {
      download: true,
      header: true,
      complete: function(results) {
        const rawData = results.data.filter(d => d.created_time);

        const yearCounts = {};
        rawData.forEach(d => {
          const year = new Date(d.created_time).getFullYear();
          if (!isNaN(year)) {
            yearCounts[year] = (yearCounts[year] || 0) + 1;
          }
        });

        const data = Object.keys(yearCounts)
          .map(year => ({ year: +year, count: yearCounts[year] }))
          .sort((a, b) => a.year - b.year);

        createTimelineChart(data);
      }
    });
  }

  function loadChartData() {
    Papa.parse('数量统计.csv', {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data.filter(d => d.region && d.count).map(d => ({
          region: d.region,
          count: +d.count
        }));
        createBarChart(data);
      }
    });
  }

  function createBarChart(data) {
    d3.select("#chart-container").selectAll("*").remove();
    
    const container = document.getElementById('chart-container');
    const width = container.clientWidth;
    const height = container.clientHeight;
    const margin = {top: 40, right: 30, bottom: 100, left: 60};
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;
    
    const svg = d3.select("#chart-container")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    const g = svg.append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    svg.append('defs')
      .append('pattern')
      .attr('id', 'barPattern')
      .attr('patternUnits', 'userSpaceOnUse')
      .attr('width', 20)
      .attr('height', 20)
      .append('image')
      .attr('href', '柱形图.png')
      .attr('preserveAspectRatio', 'none')
      .attr('width', 20)
      .attr('height', 20);

    const x = d3.scaleBand()
      .domain(data.map(d => d.region))
      .range([0, innerWidth])
      .padding(0.2);
    
    const y = d3.scaleLinear()
      .domain([0, d3.max(data, d => d.count) * 1.1])
      .range([innerHeight, 0])
      .nice();
    
    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);
    
    g.selectAll(".bar")
      .data(data)
      .enter()
      .append("rect")
      .attr("class", "bar")
      .attr("x", d => x(d.region))
      .attr("y", d => y(d.count))
      .attr("width", x.bandwidth())
      .attr("height", d => innerHeight - y(d.count))
      .attr("fill", "url(#barPattern)")
      .on("mouseover", function(event, d) {
        d3.select(this)
          .transition()
          .duration(200)
          .attr("opacity", 0.8);
        
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(`${d.region}<br>诗歌数量: ${d.count}`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        d3.select(this)
          .transition()
          .duration(200)
          .attr("opacity", 1);
        
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });
    
    g.selectAll(".value-label")
      .data(data)
      .enter()
      .append("text")
      .attr("class", "value-label")
      .attr("x", d => x(d.region) + x.bandwidth() / 2)
      .attr("y", d => y(d.count) - 10)
      .attr("dy", "0.75em")
      .text(d => d.count);
    
    g.append("g")
      .attr("class", "axis axis-x")
      .attr("transform", `translate(0,${innerHeight})`)
      .call(d3.axisBottom(x))
      .selectAll("text")
      .attr("class", "axis-text")
      .attr("dy", "1em")
      .attr("transform", "rotate(-45)")
      .style("text-anchor", "end");
    
    g.append("g")
      .attr("class", "axis axis-y")
      .call(d3.axisLeft(y).ticks(5))
      .selectAll("text")
      .attr("class", "axis-text");

    g.selectAll(".domain")
     .attr("stroke", "#666")
     .attr("stroke-width", 3);

    g.selectAll(".tick line")
     .attr("stroke", "#bbb")
     .attr("stroke-dasharray", "2,2")
     .attr("stroke-width", 2);
    
    g.append("text")
      .attr("class", "axis-text")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left + 15)
      .attr("x", -innerHeight / 2)
      .attr("text-anchor", "middle")
      .text(translations[currentLang].barChartYAxis);
    
    g.append("text")
      .attr("class", "chart-title")
      .attr("x", innerWidth / 2)
      .attr("y", -10)
      .text(translations[currentLang].barChartTitle);
  }

  function createTimelineChart(data) {
    d3.select("#chart-container").selectAll("*").remove();

    const container = document.getElementById('chart-container');
    const width = container.clientWidth;
    const height = container.clientHeight;
    const margin = {top: 40, right: 30, bottom: 100, left: 60};
    const innerWidth = width - margin.left - margin.right;
    const innerHeight = height - margin.top - margin.bottom;

    const svg = d3.select("#chart-container")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    const defs = svg.append("defs");
    defs.append("linearGradient")
      .attr("id", "areaGradient")
      .attr("x1", "0%")
      .attr("y1", "0%")
      .attr("x2", "0%")
      .attr("y2", "100%")
      .selectAll("stop")
      .data([
        {offset: "0%", color: "#f0f0f0", opacity: 0.6},
        {offset: "100%", color: "#f0f0f0", opacity: 0.2}
      ])
      .enter()
      .append("stop")
      .attr("offset", d => d.offset)
      .attr("stop-color", d => d.color)
      .attr("stop-opacity", d => d.opacity);

    const g = svg.append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    const x = d3.scaleLinear()
      .domain(d3.extent(data, d => d.year))
      .range([0, innerWidth]);

    const y = d3.scaleLinear()
      .domain([0, d3.max(data, d => d.count) * 1.1])
      .range([innerHeight, 0])
      .nice();

    const line = d3.line()
      .x(d => x(d.year))
      .y(d => y(d.count))
      .curve(d3.curveMonotoneX);

    const area = d3.area()
      .x(d => x(d.year))
      .y0(innerHeight)
      .y1(d => y(d.count))
      .curve(d3.curveMonotoneX);

    g.append("path")
      .datum(data)
      .attr("class", "timeline-area")
      .attr("d", area);

    const path = g.append("path")
      .datum(data)
      .attr("class", "timeline-line")
      .attr("d", line)
      .attr("stroke", "#000")
      .attr("stroke-width", 3)
      .attr("fill", "none")
      .attr("stroke-dasharray", function() {
        return this.getTotalLength();
      })
      .attr("stroke-dashoffset", function() {
        return this.getTotalLength();
      });

    path.transition()
      .duration(2000)
      .ease(d3.easeLinear)
      .attr("stroke-dashoffset", 0);

    const tooltip = d3.select("body").append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    g.selectAll(".dot-group")
      .data(data)
      .enter()
      .append("g")
      .attr("class", "dot-group")
      .attr("transform", d => `translate(${x(d.year)},${y(d.count)})`)
      .on("mouseover", function(event, d) {
        d3.select(this).select("circle")
          .attr("r", 8)
          .attr("fill", "#333");

        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(`年份: ${d.year}<br>诗歌数量: ${d.count}`)
          .style("left", (event.pageX + 10) + "px")
          .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        d3.select(this).select("circle")
          .attr("r", 5)
          .attr("fill", "#000");

        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      })
      .append("circle")
      .attr("class", "timeline-dot")
      .attr("r", 5)
      .attr("fill", "#000");

    g.selectAll(".timeline-label")
      .data(data)
      .enter()
      .append("text")
      .attr("class", "timeline-label")
      .attr("x", d => x(d.year))
      .attr("y", d => y(d.count) - 15)
      .attr("dy", "0.35em")
      .text(d => d.count);

    g.append("g")
      .attr("transform", `translate(0,${innerHeight})`)
      .call(d3.axisBottom(x).tickFormat(d3.format("d")))
      .selectAll("text")
      .attr("class", "axis-text")
      .attr("transform", "rotate(-45)")
      .style("text-anchor", "end");

    g.append("g")
      .call(d3.axisLeft(y).ticks(5))
      .selectAll("text")
      .attr("class", "axis-text");

    g.selectAll(".domain")
      .attr("stroke", "#666")
      .attr("stroke-width", 2);

    g.selectAll(".tick line")
      .attr("stroke", "#ddd")
      .attr("stroke-width", 1);

    g.append("text")
      .attr("class", "axis-text")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left + 15)
      .attr("x", -innerHeight / 2)
      .attr("text-anchor", "middle")
      .text(translations[currentLang].lineChartYAxis);

    g.append("text")
      .attr("class", "chart-title")
      .attr("x", innerWidth / 2)
      .attr("y", -10)
      .text(translations[currentLang].lineChartTitle);
  }

  function loadConceptNetwork() {
    d3.select("#chart-container").selectAll("*").remove();
    
    const container = document.getElementById('chart-container');
    const containerDiv = d3.select("#chart-container")
      .append("div")
      .attr("id", "concept-network-container")
      .style("width", "100%")
      .style("height", "100%")
      .style("overflow", "auto");
    
    fetch('concept-network.svg')
      .then(response => response.text())
      .then(svgText => {
        containerDiv.html(svgText);
        
        const svgElement = containerDiv.select("svg")
          .attr("width", "100%")
          .attr("height", "100%")
          .style("background-color", "rgba(255,255,255,0.85)");
        
        const scripts = svgElement.selectAll("script");
        scripts.each(function() {
          const script = document.createElement('script');
          script.textContent = this.textContent;
          document.body.appendChild(script).parentNode.removeChild(script);
        });
        
        addExtraInteractivity();
      })
      .catch(error => {
        console.error("Error loading concept network:", error);
        containerDiv.html("<p>无法加载概念网络图表</p>");
      });
  }

  function addExtraInteractivity() {
    d3.selectAll(".node")
      .on("mouseover", function() {
        d3.select(this).style("opacity", 0.8);
      })
      .on("mouseout", function() {
        d3.select(this).style("opacity", 1);
      });
    
    d3.selectAll(".link")
      .on("click", function() {
        console.log("链接被点击");
      });
  }

  let currentPage = 1;
  const rowsPerPage = 10;
  let wordFrequencyData = [];

  function loadWordFrequency() {
    Papa.parse('高频词.csv', {
      download: true,
      header: true,
      complete: function(results) {
        wordFrequencyData = results.data
          .filter(d => d.Rank && d.Character && d.Freq)
          .slice(0, 20);
        
        currentPage = 1;
        renderWordFrequencyTable();
      },
      error: function(error) {
        console.error("加载高频词数据出错:", error);
        d3.select("#chart-container")
          .append("div")
          .style("text-align", "center")
          .style("margin-top", "100px")
          .style("font-family", "'GuFeng', serif")
          .style("font-size", "18px")
          .text("无法加载高频词数据");
      }
    });
  }

  function renderWordFrequencyTable() {
    d3.select("#chart-container").selectAll("*").remove();
    
    d3.select("#chart-container")
      .append("h3")
      .style("text-align", "center")
      .style("font-family", "'GuFeng', serif")
      .style("margin-top", "20px")
      .text(translations[currentLang].wordFreqTableTitle);
    
    const tableContainer = d3.select("#chart-container")
      .append("div")
      .attr("id", "table-container");
    
    const startIdx = (currentPage - 1) * rowsPerPage;
    const endIdx = startIdx + rowsPerPage;
    const pageData = wordFrequencyData.slice(startIdx, endIdx);
    
    const table = tableContainer.append("table")
      .attr("class", "freq-table");
    
    const thead = table.append("thead");
    const headerRow = thead.append("tr");
    
    headerRow.append("th")
      .attr("class", "sortable")
      .text(translations[currentLang].wordFreqRank)
      .on("click", () => {
        wordFrequencyData.sort((a, b) => a.Rank - b.Rank);
        currentPage = 1;
        renderWordFrequencyTable();
      });
    
    headerRow.append("th")
      .attr("class", "sortable")
      .text(translations[currentLang].wordFreqCharacter)
      .on("click", () => {
        wordFrequencyData.sort((a, b) => a.Character.localeCompare(b.Character));
        currentPage = 1;
        renderWordFrequencyTable();
      });
    
    headerRow.append("th")
      .attr("class", "sortable")
      .text(translations[currentLang].wordFreqFreq)
      .on("click", () => {
        wordFrequencyData.sort((a, b) => b.Freq - a.Freq);
        currentPage = 1;
        renderWordFrequencyTable();
      });
    
    const tbody = table.append("tbody");
    
    const rows = tbody.selectAll("tr")
      .data(pageData)
      .enter()
      .append("tr");
    
    rows.append("td")
      .text(d => d.Rank);
    
    rows.append("td")
      .text(d => d.Character)
      .style("font-size", "18px");
    
    rows.append("td")
      .text(d => d.Freq);
    
    rows.on("mouseover", function() {
        d3.select(this).classed("highlight", true);
      })
      .on("mouseout", function() {
        d3.select(this).classed("highlight", false);
      })
      .on("click", function(event, d) {
        alert(`选中词语: ${d.Character}\n排名: ${d.Rank}\n出现频率: ${d.Freq}`);
      });
    
    const totalPages = Math.ceil(wordFrequencyData.length / rowsPerPage);
    
    const paginationDiv = d3.select("#chart-container")
      .append("div")
      .attr("class", "pagination-controls");
    
    paginationDiv.append("button")
      .attr("class", "page-button")
      .text("上一页")
      .property("disabled", currentPage === 1)
      .on("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderWordFrequencyTable();
        }
      });
    
    paginationDiv.append("span")
      .attr("class", "page-info")
      .text(`第 ${currentPage} 页 / 共 ${totalPages} 页`);
    
    paginationDiv.append("button")
      .attr("class", "page-button")
      .text("下一页")
      .property("disabled", currentPage === totalPages)
      .on("click", () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderWordFrequencyTable();
        }
      });
  }

  window.addEventListener('load', function() {
    const buttons = document.querySelectorAll('.nav-button');
    buttons.forEach((btn, index) => {
      setTimeout(() => {
        btn.style.opacity = 1;
      }, index * 500);
    });
  });

        let poemsData = [];
        let isChineseSearch = true;
        let currentDisplayMode = 'grid';
        let searchTimeout = null;
        let currentSortMethod = 'default';

        function loadPoemsData() {
            if (poemsData.length > 0) {
                renderPoemsGrid();
                return;
            }
            
            Papa.parse('杜甫诗歌全文数据v2.csv', {
                download: true,
                header: true,
                complete: function(results) {
                    poemsData = results.data.map(item => ({
                        id: item.序号,
                        title: item.标题,
                        original: formatPoemContent(item.内容),
                        translationTitle: item.Title,
                        translation: formatPoemContent(item.Content),
                        // 添加拼音字段用于可能的拼音搜索
                        pinyin: item.Pinyin || ""
                    }));
                    
                    renderPoemsGrid();
                    initSearchInput();
                },
                error: function(error) {
                    console.error("加载诗歌数据出错:", error);
                    document.getElementById('poems-grid').innerHTML = 
                        '<div class="error-message">数据加载失败</div>';
                }
            });
        }

        function renderPoemsGrid(poems = poemsData) {
            const gridContainer = document.getElementById('poems-grid');
            gridContainer.innerHTML = '';
            poems.forEach(poem => {
                const card = document.createElement('div');
                card.className = 'poem-card';
                const title = poem.title || '未知标题';
                const translationTitle = poem.translationTitle || '未知译文标题';
                const original = poem.original || '内容未找到';
                const translation = poem.translation || '译文未找到';
                card.innerHTML = `
                    <div class="poem-card-title-container">
                        <div class="poem-card-title">${poem.title}</div>
                        <div class="poem-card-translation-title">${poem.translationTitle}</div>
                    </div>
                    <div class="poem-card-content">
                        <div class="poem-card-original">
                            <div class="poem-card-section-title">原文</div>
                            <div class="poem-card-text">${poem.original}</div>
                        </div>
                        <div class="poem-card-translation">
                            <div class="poem-card-section-title">译文</div>
                            <div class="poem-card-text">${poem.translation}</div>
                        </div>
                    </div>
                    <div class="view-full-button" onclick="event.stopPropagation(); showSinglePoem(${poem.id})">查看完整内容</div>
                `;
                card.onclick = () => showSinglePoem(poem.id);
                gridContainer.appendChild(card);
            });

            document.getElementById('poems-grid').style.display = 'grid';
            document.getElementById('single-poem-display').style.display = 'none';
            document.getElementById('search-results').style.display = 'none';
            currentDisplayMode = 'grid';
        }

        function showSinglePoem(poemId) {
            const poem = poemsData.find(p => p.id == poemId);
            if (!poem) return;

            document.getElementById('original-content').innerHTML =
                `<strong>${poem.title}</strong><br><br>${poem.original}`;
            document.getElementById('translation-content').innerHTML =
                `<strong>${poem.translationTitle}</strong><br><br>${poem.translation}`;

            document.getElementById('poems-grid').style.display = 'none';
            document.getElementById('single-poem-display').style.display = 'block';
            document.getElementById('search-results').style.display = 'none';
            currentDisplayMode = 'single';

            document.getElementById('page-translation').scrollTo(0, 0);
        }

        function showAllPoems() {
            renderPoemsGrid();
        }

        function formatPoemContent(content) {
            if (!content) return "";
            return content.replace(/\n/g, '<br>');
        }

        function initSearchInput() {
            const searchInput = document.getElementById('poem-search-input');
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const keyword = this.value.trim();
                    filterAndRenderPoems(keyword);
                }, 300); // 300毫秒延迟，减少频繁渲染
            });
        }

        // 根据关键词筛选并渲染诗歌
        function filterAndRenderPoems(keyword) {
            if (!keyword) {
                renderPoemsGrid(poemsData);
                return;
            }
            
            const filteredPoems = poemsData.filter(poem => 
                poem.title.includes(keyword) || 
                (poem.pinyin && poem.pinyin.toLowerCase().includes(keyword.toLowerCase()))
            );
            
            renderPoemsGrid(filteredPoems);
        }

        // 渲染诗歌网格
        function renderPoemsGrid(poems = poemsData) {
            const gridContainer = document.getElementById('poems-grid');
            
            if (poems.length === 0) {
                gridContainer.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:20px;color:#666;">未找到匹配的诗歌</div>';
                return;
            }
            
            gridContainer.innerHTML = '';
            
            poems.forEach(poem => {
                const card = document.createElement('div');
                card.className = 'poem-card';
                card.innerHTML = `
                    <div class="poem-card-title-container">
                        <div class="poem-card-title">${poem.title}</div>
                        <div class="poem-card-translation-title">${poem.translationTitle}</div>
                    </div>
                    <div class="poem-card-content">
                        <div class="poem-card-original">
                            <div class="poem-card-section-title">${translations[currentLang].poemOriginalTitle}</div>
                            <div class="poem-card-text">${poem.original}</div>
                        </div>
                        <div class="poem-card-translation">
                            <div class="poem-card-section-title">${translations[currentLang].poemTranslationTitle}</div>
                            <div class="poem-card-text">${poem.translation}</div>
                        </div>
                    </div>
                    <div class="view-full-button" onclick="event.stopPropagation(); showSinglePoem(${poem.id})">查看完整内容</div>
                `;
                card.onclick = () => showSinglePoem(poem.id);
                gridContainer.appendChild(card);
            });
            
            document.getElementById('poems-grid').style.display = 'grid';
            document.getElementById('single-poem-display').style.display = 'none';
        }

    window.onload = function () {
        loadPoemsData();
    };

        async function loadStatementContent(lang) {
          const statementContent = document.getElementById('statement-content');
          const filePath = lang === 'zh'? 'shengmingC.docx' :'shengmingE.docx';
          try {
            const response = await fetch(filePath);
            if (!response.ok) {
              throw new Error(`请求失败，状态码: ${response.status}`);
            }
            const arrayBuffer = await response.arrayBuffer();
            const result = await mammoth.convertToHtml({ arrayBuffer: arrayBuffer });
            statementContent.innerHTML = result.value;
          } catch (error) {
            console.error('读取文件时出错:', error);
          }
        }
        // 初始化页面，加载中文声明内容（可优化合并到一个window.onload中）
        window.addEventListener('load', async function () {
          await loadStatementContent('zh');
        });
        // 切换按钮点击事件
        document.getElementById('lang-switch-button2').addEventListener('click', async function () {
          const currentLang = this.textContent === 'English'? 'zh' : 'en';
          const targetLang = currentLang === 'zh'? 'en' : 'zh';
          await loadStatementContent(targetLang);
          this.textContent = targetLang === 'zh'? 'English' : '切换为中文';
        }); 

        function renderSentimentChart() {
            d3.select("#chart-container").selectAll("*").remove();

            fetch('emotion_scores.json')
                .then(res => res.json())
                .then(data => {
                    data = data.map(d => ({
                      ...d,
                      id: +d.id,
                      polarity: +d.polarity
                    })).sort((a, b) => a.id - b.id);

                    const container = document.getElementById('chart-container');
                    const width = container.clientWidth;
                    const height = container.clientHeight;
                    const margin = { top: 40, right: 120, bottom: 60, left: 60 };

                    const svg = d3.select("#chart-container")
                        .append("svg")
                        .attr("width", width)
                        .attr("height", height);

                    const x = d3.scaleBand()
                        .domain(data.map(d => d.id))
                        .range([margin.left, width - margin.right])
                        .padding(0.2);

                    const y = d3.scaleLinear()
                        .domain([-1, 1])
                        .range([height - margin.bottom, margin.top]);

                    const colorScale = d3.scaleSequential()
                        .domain([-1, 1])
                        .interpolator(d3.interpolateRdYlGn);

                    const legendWidth = 10;
                    const legendHeight = 200;
                    const legendX = width - margin.right + 40;
                    const legendY = (height - legendHeight) / 2;

                    const defs = svg.append("defs");
                    const gradient = defs.append("linearGradient")
                        .attr("id", "colorGradient")
                        .attr("x1", "0%")
                        .attr("x2", "0%")
                        .attr("y1", "100%")
                        .attr("y2", "0%");

                    gradient.append("stop")
                        .attr("offset", "0%")
                        .attr("stop-color", "red");

                    gradient.append("stop")
                        .attr("offset", "50%")
                        .attr("stop-color", "yellow");

                    gradient.append("stop")
                        .attr("offset", "100%")
                        .attr("stop-color", "green");

                    svg.append("rect")
                       .attr("x", legendX)
                       .attr("y", legendY)
                       .attr("width", legendWidth)
                       .attr("height", legendHeight)
                       .style("fill", "url(#colorGradient)")
                       .style("stroke", "#333")
                       .style("stroke-width", 1);

                    // 添加比例尺刻度
                    const legendScale = d3.scaleLinear()
                       .domain([-1, 1])
                       .range([legendY + legendHeight, legendY]);

                    const legendAxis = d3.axisRight(legendScale)
                       .ticks(5)
                       .tickFormat(d3.format(".1f"));

                    svg.append("g")
                       .attr("class", "axis")
                       .attr("transform", `translate(${legendX + legendWidth},0)`)
                       .call(legendAxis)
                       .selectAll("text")
                       .attr("class", "axis-text");

                    // 添加比例尺标题
                    svg.append("text")
                       .attr("x", legendX + legendWidth / 2)
                       .attr("y", legendY - 10)
                       .attr("text-anchor", "middle")
                       .attr("class", "axis-text")
                       .text(translations[currentLang].senti_scale);
                    
                    svg.append("text")
                       .attr("x", legendX + legendWidth - 60)
                       .attr("y", legendY + 5)
                       .attr("class", "axis-text")
                       .text(translations[currentLang].senti_edge1);

                    svg.append("text")
                       .attr("x", legendX + legendWidth - 60)
                       .attr("y", legendY + legendHeight + 5)
                       .attr("class", "axis-text")
                       .text(translations[currentLang].senti_edge2);

                    // 创建工具提示元素
                    const tooltip = d3.select("body").append("div")
                        .attr("class", "tooltip")
                        .style("opacity", 0)
                        .style("position", "absolute")
                        .style("background", "white")
                        .style("padding", "8px")
                        .style("border-radius", "4px")
                        .style("box-shadow", "0 0 5px rgba(0,0,0,0.3)")
                        .style("pointer-events", "none")
                        .style("font-family", "'GuFeng', serif");

                    svg.append("g")
                        .attr("transform", `translate(0,${height - margin.bottom})`)
                        .call(d3.axisBottom(x).tickValues(x.domain().filter((d, i) => i % 10 === 0)))
                        .selectAll("text")
                        .attr("class", "axis-text");

                    svg.append("text")
                        .attr("x", width / 2)
                        .attr("y", height - 25)
                        .attr("text-anchor", "middle")
                        .attr("class", "axis-text")
                        .text(translations[currentLang].poem_id);

                    svg.append("g")
                        .attr("transform", `translate(${margin.left},0)`)
                        .call(d3.axisLeft(y))
                        .selectAll("text")
                        .attr("class", "axis-text");

                    svg.append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("x", -height / 2)
                        .attr("y", 30)
                        .attr("text-anchor", "middle")
                        .attr("class", "axis-text")
                        .text(translations[currentLang].sentimental_index);

                    svg.selectAll(".emotion-bar")
                        .data(data)
                        .enter()
                        .append("rect")
                        .attr("class", "emotion-bar")
                        .attr("x", d => x(d.id))
                        .attr("y", d => y(Math.max(0, d.polarity)))
                        .attr("height", d => Math.abs(y(d.polarity) - y(0)))
                        .attr("width", x.bandwidth())
                        .attr("fill", d => colorScale(d.polarity))
                        .on("mouseover", function(event, d) {
                            // 高亮当前柱形
                            d3.select(this)
                                .attr("stroke", "#000")
                                .attr("stroke-width", 2);

                            // 显示工具提示
                            tooltip.transition()
                                .duration(200)
                                .style("opacity", .9);
                            tooltip.html(`ID: ${d.id}<br>标题: ${d.title || '无标题'}<br>情感值: ${d.polarity.toFixed(2)}`)
                                .style("left", (event.pageX + 10) + "px")
                                .style("top", (event.pageY - 28) + "px");
                        })
                        .on("mouseout", function() {
                            // 移除高亮
                            d3.select(this)
                                .attr("stroke", "none");

                            // 隐藏工具提示
                            tooltip.transition()
                                .duration(500)
                                .style("opacity", 0);
                        })
                        .on("click", function(event, d) {
                            // 点击时跳转到翻译页面并显示对应诗歌
                            switchPage('translation');
                            // 使用setTimeout确保页面切换完成后再显示诗歌
                            setTimeout(() => {
                                showSinglePoem(d.id);
                            }, 100);
                        });

                    // 添加图表标题
                    svg.append("text")
                        .attr("x", width / 2)
                        .attr("y", margin.top / 2)
                        .attr("text-anchor", "middle")
                        .attr("class", "chart-title")
                        .text(translations[currentLang].senti_title);
                })
                .catch(error => {
                    console.error("加载情感分析数据出错:", error);
                    d3.select("#chart-container")
                        .append("div")
                        .style("text-align", "center")
                        .style("margin-top", "100px")
                        .style("font-family", "'GuFeng', serif")
                        .style("font-size", "18px")
                        .text("无法加载情感分析数据");
                });
        }
        
        //测试阶段评论与弹幕渲染
        let comment = JSON.parse(localStorage.getItem('comments')) || [];
        
        function renderBulletChat() {
          //弹幕渲染逻辑
        }

        function renderCommentList() {
          //评论列表渲染逻辑
        }

        document.getElementById('submit-comment').addEventListener('click', () => {
          const nickname = document.getElementById('nickname-input').value.trim();
          const comment = document.getElementById('comment-input').value.trim();
          //提交评论逻辑
          if (comment) {
             // 创建评论对象
            const newComment = {
              nickname: nickname || "匿名用户",
              comment: comment,
              timestamp: new Date().toISOString(), // 记录时间
              likes: 0 // 点赞数
            };
    
            // 从本地存储读取现有评论
            const comments = JSON.parse(localStorage.getItem('comments')) || [];
    
            // 添加新评论
            comments.push(newComment);
    
            // 保存回本地存储
            localStorage.setItem('comments', JSON.stringify(comments));
    
            // 清空输入框
            document.getElementById('comment-input').value = '';
    
            // 重新渲染评论列表和弹幕
            renderCommentList();
            renderBulletChat();
          }
        });

// 获取DOM元素
const nicknameInput = document.getElementById('nickname-input');
const commentInput = document.getElementById('comment-input');
const submitButton = document.getElementById('submit-comment');
const commentList = document.querySelector('.comment-list');
const bulletChatContainer = document.querySelector('.bullet-chat-container');

// 实时检测评论输入
commentInput.addEventListener('input', function() {
  // 去除首尾空格后检查内容是否为空
  const hasContent = this.value.trim().length > 0;
  
  // 根据是否有内容启用/禁用按钮
  submitButton.disabled = !hasContent;
  
  // 可视化的禁用状态样式
  if(hasContent) {
    submitButton.style.opacity = '1';
    submitButton.style.cursor = 'pointer';
  } else {
    submitButton.style.opacity = '0.6';
    submitButton.style.cursor = 'not-allowed';
  }
});

// 加载评论
function loadComments() {
    return JSON.parse(localStorage.getItem('comments')) || [];
}

// 保存评论
function saveComments(comments) {
    localStorage.setItem('comments', JSON.stringify(comments));
}

// 渲染评论列表
function renderCommentList() {
    const comments = loadComments();
    commentList.innerHTML = comments.map(comment => `
        <div class="comment-item" style="margin-bottom: 15px; padding: 10px; border-bottom: 1px solid #eee;">
            <div style="font-weight: bold; margin-bottom: 5px;">${comment.nickname}</div>
            <div style="margin-bottom: 5px;">${comment.comment}</div>
            <div style="font-size: 12px; color: #888;">${new Date(comment.timestamp).toLocaleString()}</div>
        </div>
    `).join('');
}

// 渲染弹幕
function renderBulletChat() {
    const comments = loadComments();
    bulletChatContainer.innerHTML = '';
    
    comments.slice(-20).forEach(comment => {
        const bullet = document.createElement('div');
        bullet.className = 'bullet-chat';
        bullet.textContent = `${comment.nickname}: ${comment.comment}`;
        bullet.style.position = 'absolute';
        bullet.style.whiteSpace = 'nowrap';
        bullet.style.fontFamily = "'GuFeng', serif";
        bullet.style.color = `hsl(${Math.random() * 360}, 70%, 50%)`;
        bullet.style.fontSize = '18px';
        
        // 随机位置和动画
        const topPos = Math.random() * 80 + 10;
        bullet.style.top = `${topPos}%`;
        bullet.style.left = '100%';
        bullet.style.transform = 'translateX(0)';
        
        bulletChatContainer.appendChild(bullet);
        
        // 动画
        const duration = Math.random() * 10000 + 10000;
        bullet.style.transition = `transform ${duration}ms linear`;
        
        setTimeout(() => {
            bullet.style.transform = 'translateX(-2000px)';
        }, 100);
    });
}

// 提交评论
document.getElementById('submit-comment').addEventListener('click', () => {
    const nickname = nicknameInput.value.trim();
    const commentText = commentInput.value.trim();
    
    if (commentText) {
        const comments = loadComments();
        const newComment = {
            nickname: nickname || "匿名用户",
            comment: commentText,
            timestamp: new Date().toISOString()
        };
        
        comments.push(newComment);
        saveComments(comments);
        
        // 清空输入框
        commentInput.value = '';
        submitButton.disabled = true;
        
        // 重新渲染
        renderCommentList();
        renderBulletChat();
    }
});

// 实时检测评论输入
commentInput.addEventListener('input', function() {
    submitButton.disabled = this.value.trim().length === 0;
});

// 初始化加载
document.addEventListener('DOMContentLoaded', () => {
    renderCommentList();
    renderBulletChat();
    
    // 弹幕动画循环
    setInterval(renderBulletChat, 15000);
});

</script>
</body>
</html>